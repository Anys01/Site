<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commande de Boissons</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles */
        .drink-card:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #notification.show {
            opacity: 1;
        }
        .order-card {
            transition: all 0.3s ease;
        }
        .order-card:hover {
            background-color: #f8fafc;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Notification -->
    <div id="notification" class="bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden">
        <span id="notification-message"></span>
    </div>

    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-bold">Bar à Boissons</h1>
            <div>
                <button id="adminBtn" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-gray-100 flex items-center">
                    <i class="fas fa-user-cog mr-2"></i> Admin
                </button>
            </div>
        </div>
    </header>

    <!-- Client Interface -->
    <main id="clientInterface" class="container mx-auto px-4 py-8">
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Choisissez vos boissons</h2>
            
            <!-- Categories -->
            <div class="flex flex-wrap gap-2 mb-8 justify-center">
                <button class="category-btn active px-4 py-2 bg-blue-600 text-white rounded-full" data-category="all">Tous</button>
                <button class="category-btn px-4 py-2 bg-gray-200 rounded-full hover:bg-blue-100" data-category="cold">Boissons froides</button>
                <button class="category-btn px-4 py-2 bg-gray-200 rounded-full hover:bg-blue-100" data-category="hot">Boissons chaudes</button>
                <button class="category-btn px-4 py-2 bg-gray-200 rounded-full hover:bg-blue-100" data-category="alcohol">Alcools</button>
            </div>
            
            <!-- Drinks Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="drinksGrid">
                <!-- Drinks will be loaded here -->
            </div>
        </section>
    </main>

    <!-- Shopping Cart Sidebar -->
    <div id="cartSidebar" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <div class="h-full flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-blue-600 text-white">
                <h3 class="text-xl font-bold">Votre Panier</h3>
                <button id="closeCartBtn" class="text-white hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="flex-grow overflow-y-auto p-4" id="cartItems">
                <!-- Cart items will be loaded here -->
                <div class="text-center text-gray-500 py-12">
                    <i class="fas fa-shopping-cart text-4xl mb-4"></i>
                    <p>Votre panier est vide</p>
                </div>
            </div>
            
            <div class="p-4 border-t">
                <div class="flex justify-between mb-4">
                    <span class="font-bold">Total:</span>
                    <span id="cartTotal" class="font-bold">0.00 €</span>
                </div>
                <button id="checkoutBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium disabled:opacity-50" disabled>
                    Commander (<span id="cartCount">0</span>)
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Button -->
    <div id="cartButton" class="fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg cursor-pointer hover:bg-blue-700 transition-all z-40">
        <i class="fas fa-shopping-cart text-xl"></i>
        <span id="cartBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full hidden">0</span>
    </div>

    <!-- Order Modal -->
    <div id="orderModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg overflow-hidden shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 class="text-2xl font-bold mb-4 text-center">Confirmer votre commande</h3>
                
                <div id="orderSummary" class="mb-6 max-h-64 overflow-y-auto">
                    <!-- Order items will be here -->
                </div>
                
                <div class="mb-6">
                    <label for="customerName" class="block text-gray-700 mb-2">Votre nom</label>
                    <input type="text" id="customerName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nom pour la commande">
                </div>
                
                <div class="flex justify-end space-x-4">
                    <button id="cancelOrderBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-100">Annuler</button>
                    <button id="confirmOrderBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Confirmer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg overflow-hidden shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 class="text-2xl font-bold mb-6 text-center">Connexion Admin</h3>
                
                <div class="mb-4">
                    <label for="adminUsername" class="block text-gray-700 mb-2">Identifiant</label>
                    <input type="text" id="adminUsername" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="mb-6">
                    <label for="adminPassword" class="block text-gray-700 mb-2">Mot de passe</label>
                    <input type="password" id="adminPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="flex justify-end space-x-4">
                    <button id="cancelAdminLoginBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-100">Annuler</button>
                    <button id="loginAdminBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Connexion</button>
                </div>
                
                <p id="loginError" class="text-red-500 mt-4 text-center hidden">Identifiants incorrects</p>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden fixed inset-0 bg-gray-100 z-40 overflow-y-auto">
        <div class="container mx-auto px-4 py-6">
            <!-- Admin Header -->
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-user-cog mr-3"></i> Panneau d'Administration
                </h2>
                <button id="logoutBtn" class="flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                    <i class="fas fa-sign-out-alt mr-2"></i> Déconnexion
                </button>
            </div>
            
            <!-- Admin Tabs -->
            <div class="mb-6 border-b border-gray-200">
                <div class="flex flex-wrap -mb-px">
                    <button class="admin-tab active mr-2 py-2 px-4 font-medium border-b-2 border-blue-500 text-blue-600" data-tab="dashboard">
                        <i class="fas fa-tachometer-alt mr-2"></i> Tableau de bord
                    </button>
                    <button class="admin-tab mr-2 py-2 px-4 font-medium text-gray-500 hover:text-gray-700" data-tab="orders">
                        <i class="fas fa-clipboard-list mr-2"></i> Commandes
                    </button>
                    <button class="admin-tab mr-2 py-2 px-4 font-medium text-gray-500 hover:text-gray-700" data-tab="products">
                        <i class="fas fa-cocktail mr-2"></i> Produits
                    </button>
                    <button class="admin-tab mr-2 py-2 px-4 font-medium text-gray-500 hover:text-gray-700" data-tab="users">
                        <i class="fas fa-users mr-2"></i> Utilisateurs
                    </button>
                </div>
            </div>
            
            <!-- Tab Contents -->
            <div class="bg-white rounded-lg shadow p-6">
                <!-- Dashboard Tab -->
                <div id="dashboardTab" class="tab-content active">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-tachometer-alt mr-2"></i> Tableau de bord
                    </h3>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-sm text-blue-500">Commandes aujourd'hui</p>
                                    <p class="text-2xl font-bold text-blue-700" id="todayOrdersCount">0</p>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-clipboard-list text-blue-500"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 rounded-lg p-4 border border-green-100">
                            <div class="flex justify between items-center">
                                <div>
                                    <p class="text-sm text-green-500">Revenu aujourd'hui</p>
                                    <p class="text-2xl font-bold text-green-700" id="todayRevenue">0 €</p>
                                </div>
                                <div class="bg-green-100 p-3 rounded-full">
                                    <i class="fas fa-euro-sign text-green-500"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 rounded-lg p-4 border border-purple-100">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-sm text-purple-500">Produits disponibles</p>
                                    <p class="text-2xl font-bold text-purple-700" id="availableProducts">0</p>
                                </div>
                                <div class="bg-purple-100 p-3 rounded-full">
                                    <i class="fas fa-cocktail text-purple-500"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Orders -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-clock mr-2"></i> Commandes récentes
                        </h4>
                        <div id="recentOrdersList" class="space-y-3">
                            <!-- Recent orders will be loaded here -->
                            <div class="text-center py-6 text-gray-500">
                                <i class="fas fa-clipboard-list text-3xl mb-2"></i>
                                <p>Aucune commande récente</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div>
                        <h4 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-bolt mr-2"></i> Actions rapides
                        </h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button id="viewAllOrdersBtn" class="flex items-center justify-center px-4 py-3 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100">
                                <i class="fas fa-clipboard-list mr-2"></i> Voir toutes les commandes
                            </button>
                            <button id="addNewProductBtn" class="flex items-center justify-center px-4 py-3 bg-green-50 text-green-600 rounded-lg hover:bg-green-100">
                                <i class="fas fa-plus-circle mr-2"></i> Ajouter un produit
                            </button>
                            <button id="manageUsersBtn" class="flex items-center justify-center px-4 py-3 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100">
                                <i class="fas fa-users-cog mr-2"></i> Gérer les utilisateurs
                            </button>
                            <button id="refreshDashboardBtn" class="flex items-center justify-center px-4 py-3 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100">
                                <i class="fas fa-sync-alt mr-2"></i> Actualiser
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Orders Tab -->
                <div id="ordersTab" class="tab-content">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-clipboard-list mr-2"></i> Gestion des Commandes
                    </h3>
                    
                    <div class="mb-6 flex flex-wrap justify-between items-center">
                        <div class="mb-4 sm:mb-0">
                            <div class="relative">
                                <input type="text" id="orderSearch" placeholder="Rechercher une commande..." class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <select id="orderFilter" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">Toutes les commandes</option>
                                <option value="pending">En attente</option>
                                <option value="preparing">En préparation</option>
                                <option value="completed">Terminées</option>
                            </select>
                            <button id="refreshOrdersBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="ordersList" class="space-y-4">
                        <!-- Orders will be loaded here -->
                        <div class="text-center py-12 text-gray-500">
                            <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                            <p>Aucune commande trouvée</p>
                        </div>
                    </div>
                </div>
                
                <!-- Products Tab -->
                <div id="productsTab" class="tab-content">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-cocktail mr-2"></i> Gestion des Produits
                    </h3>
                    
                    <div class="mb-6 flex flex-wrap justify-between items-center">
                        <button id="addProductBtn" class="mb-4 sm:mb-0 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center">
                            <i class="fas fa-plus-circle mr-2"></i> Ajouter un produit
                        </button>
                        
                        <div class="flex space-x-2">
                            <select id="productCategoryFilter" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">Toutes les catégories</option>
                                <option value="cold">Boissons froides</option>
                                <option value="hot">Boissons chaudes</option>
                                <option value="alcohol">Alcools</option>
                            </select>
                            <div class="relative">
                                <input type="text" id="productSearch" placeholder="Rechercher..." class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div id="productsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Products will be loaded here -->
                        <div class="text-center py-12 text-gray-500 col-span-full">
                            <i class="fas fa-cocktail text-4xl mb-4"></i>
                            <p>Aucun produit trouvé</p>
                        </div>
                    </div>
                </div>
                
                <!-- Users Tab -->
                <div id="usersTab" class="tab-content">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-users-cog mr-2"></i> Gestion des Utilisateurs
                    </h3>
                    
                    <div class="mb-6 flex justify-between items-center">
                        <button id="addUserBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center">
                            <i class="fas fa-user-plus mr-2"></i> Ajouter un administrateur
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Nom d'utilisateur</th>
                                    <th class="p-3 text-left">Dernière connexion</th>
                                    <th class="p-3 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersList">
                                <!-- Users will be loaded here -->
                                <tr>
                                    <td colspan="3" class="p-4 text-center text-gray-500">
                                        <i class="fas fa-users text-2xl mb-2"></i>
                                        <p>Aucun utilisateur trouvé</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg overflow-hidden shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 id="productModalTitle" class="text-2xl font-bold mb-4">Ajouter un produit</h3>
                
                <div class="space-y-4">
                    <div>
                        <label for="productName" class="block text-gray-700 mb-2">Nom du produit</label>
                        <input type="text" id="productName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="productDescription" class="block text-gray-700 mb-2">Description</label>
                        <textarea id="productDescription" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="productPrice" class="block text-gray-700 mb-2">Prix (€)</label>
                            <input type="number" id="productPrice" step="0.01" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="productCategory" class="block text-gray-700 mb-2">Catégorie</label>
                            <select id="productCategory" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="cold">Boisson froide</option>
                                <option value="hot">Boisson chaude</option>
                                <option value="alcohol">Alcool</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="productImageUrl" class="block text-gray-700 mb-2">URL de l'image</label>
                        <input type="text" id="productImageUrl" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Utilisez un lien vers une image ou laissez vide pour une image par défaut</p>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-4 mt-6">
                    <button id="cancelProductBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-100">Annuler</button>
                    <button id="saveProductBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- User Modal -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg overflow-hidden shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 id="userModalTitle" class="text-2xl font-bold mb-4">Ajouter un administrateur</h3>
                
                <div class="space-y-4">
                    <div>
                        <label for="newUsername" class="block text-gray-700 mb-2">Nom d'utilisateur</label>
                        <input type="text" id="newUsername" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="newPassword" class="block text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" id="newPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="confirmPassword" class="block text-gray-700 mb-2">Confirmer le mot de passe</label>
                        <input type="password" id="confirmPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-4 mt-6">
                    <button id="cancelUserBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-100">Annuler</button>
                    <button id="saveUserBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Enregistrer</button>
                </div>
                
                <p id="userError" class="text-red-500 mt-4 text-center hidden"></p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let cart = [];
        let drinks = []; // Will be loaded from localStorage
        let orders = []; // Will be loaded from localStorage
        let users = []; // Will be loaded from localStorage
        let currentAdmin = null;
        let editingProductId = null;
        let editingUserId = null;
        
        // DOM Elements
        const clientInterface = document.getElementById('clientInterface');
        const adminPanel = document.getElementById('adminPanel');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const adminBtn = document.getElementById('adminBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const cancelAdminLoginBtn = document.getElementById('cancelAdminLoginBtn');
        const loginAdminBtn = document.getElementById('loginAdminBtn');
        const adminUsername = document.getElementById('adminUsername');
        const adminPassword = document.getElementById('adminPassword');
        const loginError = document.getElementById('loginError');
        
        // Cart elements
        const cartButton = document.getElementById('cartButton');
        const cartSidebar = document.getElementById('cartSidebar');
        const closeCartBtn = document.getElementById('closeCartBtn');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const cartCount = document.getElementById('cartCount');
        const cartBadge = document.getElementById('cartBadge');
        const checkoutBtn = document.getElementById('checkoutBtn');
        
        // Order modal elements
        const orderModal = document.getElementById('orderModal');
        const orderSummary = document.getElementById('orderSummary');
        const customerName = document.getElementById('customerName');
        const cancelOrderBtn = document.getElementById('cancelOrderBtn');
        const confirmOrderBtn = document.getElementById('confirmOrderBtn');
        
        // Admin tabs
        const adminTabs = document.querySelectorAll('.admin-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Dashboard tab
        const todayOrdersCount = document.getElementById('todayOrdersCount');
        const todayRevenue = document.getElementById('todayRevenue');
        const availableProducts = document.getElementById('availableProducts');
        const recentOrdersList = document.getElementById('recentOrdersList');
        const viewAllOrdersBtn = document.getElementById('viewAllOrdersBtn');
        const addNewProductBtn = document.getElementById('addNewProductBtn');
        const manageUsersBtn = document.getElementById('manageUsersBtn');
        const refreshDashboardBtn = document.getElementById('refreshDashboardBtn');
        
        // Orders tab
        const ordersList = document.getElementById('ordersList');
        const orderSearch = document.getElementById('orderSearch');
        const orderFilter = document.getElementById('orderFilter');
        const refreshOrdersBtn = document.getElementById('refreshOrdersBtn');
        
        // Products tab
        const productsList = document.getElementById('productsList');
        const addProductBtn = document.getElementById('addProductBtn');
        const productSearch = document.getElementById('productSearch');
        const productCategoryFilter = document.getElementById('productCategoryFilter');
        
        // Product modal
        const productModal = document.getElementById('productModal');
        const productModalTitle = document.getElementById('productModalTitle');
        const productName = document.getElementById('productName');
        const productDescription = document.getElementById('productDescription');
        const productPrice = document.getElementById('productPrice');
        const productCategory = document.getElementById('productCategory');
        const productImageUrl = document.getElementById('productImageUrl');
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        const saveProductBtn = document.getElementById('saveProductBtn');
        
        // Users tab
        const usersList = document.getElementById('usersList');
        const addUserBtn = document.getElementById('addUserBtn');
        
        // User modal
        const userModal = document.getElementById('userModal');
        const userModalTitle = document.getElementById('userModalTitle');
        const newUsername = document.getElementById('newUsername');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const cancelUserBtn = document.getElementById('cancelUserBtn');
        const saveUserBtn = document.getElementById('saveUserBtn');
        const userError = document.getElementById('userError');
        
        // Notification
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        
        // Category buttons
        const categoryButtons = document.querySelectorAll('.category-btn');
        
        // Initialize the application
        function init() {
            // Load data from localStorage
            loadData();
            
            // Render drinks
            renderDrinks();
            
            // Render cart
            updateCart();
            
            // Event listeners
            setupEventListeners();
            
            // Check if admin is logged in
            checkAdminSession();
        }
        
        function loadData() {
            // Load drinks
            if (localStorage.getItem('drinks')) {
                drinks = JSON.parse(localStorage.getItem('drinks'));
            } else {
                // Default drinks
                drinks = [
                    {
                        id: 1,
                        name: "Coca-Cola",
                        description: "Boisson gazeuse sucrée",
                        price: 2.50,
                        category: "cold",
                        image: "https://placehold.co/300x200?text=Coca-Cola"
                    },
                    {
                        id: 2,
                        name: "Café",
                        description: "Café noir",
                        price: 1.80,
                        category: "hot",
                        image: "https://placehold.co/300x200?text=Caf%C3%A9"
                    },
                    {
                        id: 3,
                        name: "Vin rouge",
                        description: "Verre de vin rouge de la région",
                        price: 3.50,
                        category: "alcohol",
                        image: "https://placehold.co/300x200?text=Vin+Rouge"
                    },
                    {
                        id: 4,
                        name: "Jus d'orange",
                        description: "Jus pressé frais",
                        price: 2.20,
                        category: "cold",
                        image: "https://placehold.co/300x200?text=Jus+d%27Orange"
                    },
                    {
                        id: 5,
                        name: "Thé",
                        description: "Thé vert ou noir",
                        price: 1.60,
                        category: "hot",
                        image: "https://placehold.co/300x200?text=Th%C3%A9"
                    },
                    {
                        id: 6,
                        name: "Bière",
                        description: "Pression artisanale",
                        price: 3.00,
                        category: "alcohol",
                        image: "https://placehold.co/300x200?text=Bi%C3%A8re"
                    }
                ];
                localStorage.setItem('drinks', JSON.stringify(drinks));
            }
            
            // Load orders
            if (localStorage.getItem('orders')) {
                orders = JSON.parse(localStorage.getItem('orders'));
            } else {
                orders = [];
                localStorage.setItem('orders', JSON.stringify(orders));
            }
            
            // Load users
            if (localStorage.getItem('users')) {
                users = JSON.parse(localStorage.getItem('users'));
            } else {
                users = [
                    {
                        id: 1,
                        username: "admin",
                        password: "admin123", // In a real app, we would hash passwords
                        lastLogin: null
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Logged in admin
            if (localStorage.getItem('currentAdmin')) {
                currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
            }
        }
        
        function saveData() {
            localStorage.setItem('drinks', JSON.stringify(drinks));
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('users', JSON.stringify(users));
            if (currentAdmin) {
                localStorage.setItem('currentAdmin', JSON.stringify(currentAdmin));
            } else {
                localStorage.removeItem('currentAdmin');
            }
        }
        
        function setupEventListeners() {
            // Admin button
            adminBtn.addEventListener('click', toggleAdminLogin);
            logoutBtn.addEventListener('click', logoutAdmin);
            cancelAdminLoginBtn.addEventListener('click', hideAdminLogin);
            loginAdminBtn.addEventListener('click', loginAdmin);
            
            // Cart events
            cartButton.addEventListener('click', toggleCart);
            closeCartBtn.addEventListener('click', closeCart);
            checkoutBtn.addEventListener('click', openOrderModal);
            
            // Order modal events
            cancelOrderBtn.addEventListener('click', closeOrderModal);
            confirmOrderBtn.addEventListener('click', placeOrder);
            
            // Admin tabs
            adminTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    activateTab(tabId);
                });
            });
            
            // Dashboard actions
            viewAllOrdersBtn.addEventListener('click', () => activateTab('orders'));
            addNewProductBtn.addEventListener('click', () => {
                openProductModal();
                activateTab('products');
            });
            manageUsersBtn.addEventListener('click', () => activateTab('users'));
            refreshDashboardBtn.addEventListener('click', refreshDashboard);
            
            // Orders tab events
            orderSearch.addEventListener('input', () => renderOrders(orderSearch.value, orderFilter.value));
            orderFilter.addEventListener('change', () => renderOrders(orderSearch.value, orderFilter.value));
            refreshOrdersBtn.addEventListener('click', () => {
                orderSearch.value = '';
                orderFilter.value = 'all';
                renderOrders();
            });
            
            // Products tab events
            addProductBtn.addEventListener('click', openProductModal);
            productSearch.addEventListener('input', () => renderProducts(productSearch.value, productCategoryFilter.value));
            productCategoryFilter.addEventListener('change', () => renderProducts(productSearch.value, productCategoryFilter.value));
            
            // Product modal events
            cancelProductBtn.addEventListener('click', closeProductModal);
            saveProductBtn.addEventListener('click', saveProduct);
            
            // Users tab events
            addUserBtn.addEventListener('click', openUserModal);
            
            // User modal events
            cancelUserBtn.addEventListener('click', closeUserModal);
            saveUserBtn.addEventListener('click', saveUser);
            
            // Category buttons
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active', 'bg-blue-600', 'text-white'));
                    button.classList.add('active', 'bg-blue-600', 'text-white');
                    renderDrinks(button.dataset.category);
                });
            });
        }
        
        function renderDrinks(category = 'all') {
            const drinksGrid = document.getElementById('drinksGrid');
            drinksGrid.innerHTML = '';
            
            const filteredDrinks = category === 'all' 
                ? drinks 
                : drinks.filter(drink => drink.category === category);
            
            if (filteredDrinks.length === 0) {
                drinksGrid.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-glass-martini-alt text-4xl mb-4"></i>
                        <p>Aucune boisson disponible dans cette catégorie</p>
                    </div>
                `;
                return;
            }
            
            filteredDrinks.forEach(drink => {
                const drinkCard = document.createElement('div');
                drinkCard.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all drink-card';
                drinkCard.innerHTML = `
                    <img src="${drink.image}" alt="${drink.name}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="text-lg font-semibold">${drink.name}</h3>
                        <p class="text-gray-600 text-sm mt-1">${drink.description}</p>
                        <div class="flex justify-between items-center mt-3">
                            <span class="font-bold text-blue-600">${drink.price.toFixed(2)} €</span>
                            <button class="add-to-cart-btn px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700" data-id="${drink.id}">
                                <i class="fas fa-cart-plus"></i>
                            </button>
                        </div>
                    </div>
                `;
                drinksGrid.appendChild(drinkCard);
            });
            
            // Add event listeners to add to cart buttons
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const drinkId = parseInt(button.dataset.id);
                    addToCart(drinkId);
                });
            });
        }
        
        function addToCart(drinkId) {
            const drink = drinks.find(d => d.id === drinkId);
            if (!drink) return;
            
            const existingItem = cart.find(item => item.drink.id === drinkId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    drink: drink,
                    quantity: 1
                });
            }
            
            updateCart();
            showNotification(`${drink.name} ajouté au panier`);
        }
        
        function updateCart() {
            // Update cart items display
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="text-center text-gray-500 py-12">
                        <i class="fas fa-shopping-cart text-4xl mb-4"></i>
                        <p>Votre panier est vide</p>
                    </div>
                `;
            } else {
                cartItems.innerHTML = '';
                cart.forEach((item, index) => {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'flex justify-between items-center mb-4 pb-4 border-b cart-item';
                    cartItem.innerHTML = `
                        <div class="flex items-center">
                            <img src="${item.drink.image}" alt="${item.drink.name}" class="w-16 h-16 object-cover rounded-lg">
                            <div class="ml-3">
                                <h4 class="font-medium">${item.drink.name}</h4>
                                <p class="text-gray-500 text-sm">${item.drink.price.toFixed(2)} €</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <button class="quantity-btn px-2 py-1 bg-gray-200 rounded" data-index="${index}" data-action="decrease">
                                <i class="fas fa-minus text-xs"></i>
                            </button>
                            <span class="mx-2 font-medium">${item.quantity}</span>
                            <button class="quantity-btn px-2 py-1 bg-gray-200 rounded" data-index="${index}" data-action="increase">
                                <i class="fas fa-plus text-xs"></i>
                            </button>
                            <button class="ml-3 remove-btn text-red-500 hover:text-red-700" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    cartItems.appendChild(cartItem);
                });
                
                // Add event listeners to quantity buttons
                document.querySelectorAll('.quantity-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(button.dataset.index);
                        const action = button.dataset.action;
                        
                        if (action === 'increase') {
                            cart[index].quantity += 1;
                        } else if (action === 'decrease') {
                            if (cart[index].quantity > 1) {
                                cart[index].quantity -= 1;
                            } else {
                                cart.splice(index, 1);
                            }
                        }
                        
                        updateCart();
                    });
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const index = parseInt(button.dataset.index);
                        cart.splice(index, 1);
                        updateCart();
                    });
                });
            }
            
            // Update cart total
            const total = cart.reduce((sum, item) => sum + (item.drink.price * item.quantity), 0);
            cartTotal.textContent = total.toFixed(2) + ' €';
            
            // Update cart count
            const itemCount = cart.reduce((count, item) => count + item.quantity, 0);
            cartCount.textContent = itemCount;
            
            // Update cart badge
            if (itemCount > 0) {
                cartBadge.textContent = itemCount;
                cartBadge.classList.remove('hidden');
                checkoutBtn.disabled = false;
            } else {
                cartBadge.classList.add('hidden');
                checkoutBtn.disabled = true;
            }
            
            saveCart();
        }
        
        function saveCart() {
            sessionStorage.setItem('cart', JSON.stringify(cart));
        }
        
        function toggleCart() {
            cartSidebar.classList.toggle('translate-x-full');
        }
        
        function openCart() {
            cartSidebar.classList.remove('translate-x-full');
        }
        
        function closeCart() {
            cartSidebar.classList.add('translate-x-full');
        }
        
        function openOrderModal() {
            // Build order summary
            let summaryHTML = `
                <table class="w-full mb-4">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left pb-2">Produit</th>
                            <th class="text-right pb-2">Quantité</th>
                            <th class="text-right pb-2">Total</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            cart.forEach(item => {
                summaryHTML += `
                    <tr>
                        <td class="py-2">${item.drink.name}</td>
                        <td class="text-right py-2">${item.quantity}</td>
                        <td class="text-right py-2">${(item.drink.price * item.quantity).toFixed(2)} €</td>
                    </tr>
                `;
            });
            
            summaryHTML += `
                    </tbody>
                    <tfoot>
                        <tr class="border-t font-bold">
                            <td class="pt-2">Total</td>
                            <td class="text-right pt-2">${cart.reduce((sum, item) => sum + item.quantity, 0)}</td>
                            <td class="text-right pt-2">${cart.reduce((sum, item) => sum + (item.drink.price * item.quantity), 0).toFixed(2)} €</td>
                        </tr>
                    </tfoot>
                </table>
            `;
            
            orderSummary.innerHTML = summaryHTML;
            customerName.value = '';
            orderModal.classList.remove('hidden');
        }
        
        function closeOrderModal() {
            orderModal.classList.add('hidden');
        }
        
        function placeOrder() {
            const name = customerName.value.trim();
            
            if (!name) {
                customerName.classList.add('border-red-500');
                customerName.addEventListener('input', () => {
                    customerName.classList.remove('border-red-500');
                });
                return;
            }
            
            const newOrder = {
                id: Date.now(),
                customerName: name,
                items: [...cart],
                total: cart.reduce((sum, item) => sum + (item.drink.price * item.quantity), 0),
                status: 'pending',
                date: new Date().toISOString()
            };
            
            orders.push(newOrder);
            saveData();
            
            cart = [];
            updateCart();
            
            closeOrderModal();
            showNotification('Commande passée avec succès!');
            
            // If admin is logged in and on orders tab, refresh orders list
            if (currentAdmin && document.querySelector('.admin-tab.active').dataset.tab === 'orders') {
                renderOrders();
            }
        }
        
        function toggleAdminLogin() {
            if (currentAdmin) {
                window.location.hash = '#admin';
                adminPanel.classList.remove('hidden');
                clientInterface.classList.add('hidden');
            } else {
                adminLoginModal.classList.remove('hidden');
            }
        }
        
        function hideAdminLogin() {
            adminLoginModal.classList.add('hidden');
            adminUsername.value = '';
            adminPassword.value = '';
            loginError.classList.add('hidden');
        }
        
        function loginAdmin() {
            const username = adminUsername.value.trim();
            const password = adminPassword.value.trim();
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentAdmin = {
                    id: user.id,
                    username: user.username
                };
                
                // Update last login
                user.lastLogin = new Date().toISOString();
                saveData();
                
                hideAdminLogin();
                
                // Show admin panel
                window.location.hash = '#admin';
                adminPanel.classList.remove('hidden');
                clientInterface.classList.add('hidden');
                
                // Show dashboard
                activateTab('dashboard');
                refreshDashboard();
                
                showNotification('Connecté en tant qu\'admin');
            } else {
                loginError.classList.remove('hidden');
            }
        }
        
        function logoutAdmin() {
            currentAdmin = null;
            saveData();
            
            adminPanel.classList.add('hidden');
            clientInterface.classList.remove('hidden');
            window.location.hash = '';
            
            showNotification('Déconnecté');
        }
        
        function checkAdminSession() {
            if (window.location.hash === '#admin') {
                if (currentAdmin) {
                    adminPanel.classList.remove('hidden');
                    clientInterface.classList.add('hidden');
                } else {
                    toggleAdminLogin();
                }
            }
        }
        
        function activateTab(tabId) {
            // Deactivate all tabs
            adminTabs.forEach(tab => {
                tab.classList.remove('active', 'border-blue-500', 'text-blue-600');
                tab.classList.add('text-gray-500');
            });
            
            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            const activeTab = document.querySelector(`.admin-tab[data-tab="${tabId}"]`);
            if (activeTab) {
                activeTab.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeTab.classList.remove('text-gray-500');
            }
            
            // Show selected tab content
            const activeContent = document.getElementById(`${tabId}Tab`);
            if (activeContent) {
                activeContent.classList.add('active');
                
                // Load data for the tab
                switch(tabId) {
                    case 'dashboard':
                        refreshDashboard();
                        break;
                    case 'orders':
                        renderOrders();
                        break;
                    case 'products':
                        renderProducts();
                        break;
                    case 'users':
                        renderUsers();
                        break;
                }
            }
        }
        
        function refreshDashboard() {
            // Count today's orders
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(order => order.date.split('T')[0] === today);
            todayOrdersCount.textContent = todayOrders.length;
            
            // Calculate today's revenue
            const todayRevenueValue = todayOrders.reduce((sum, order) => sum + order.total, 0);
            todayRevenue.textContent = todayRevenueValue.toFixed(2) + ' €';
            
            // Available products
            availableProducts.textContent = drinks.length;
            
            // Recent orders (last 5 pending or preparing)
            const recentOrders = [...orders]
                .filter(order => order.status === 'pending' || order.status === 'preparing')
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
                
            if (recentOrders.length > 0) {
                recentOrdersList.innerHTML = '';
                
                recentOrders.forEach(order => {
                    const orderItem = document.createElement('div');
                    orderItem.className = 'bg-white p-4 rounded-lg shadow-sm order-card';
                    
                    let statusClass = '';
                    if (order.status === 'pending') {
                        statusClass = 'bg-yellow-100 text-yellow-800';
                    } else if (order.status === 'preparing') {
                        statusClass = 'bg-blue-100 text-blue-800';
                    } else if (order.status === 'completed') {
                        statusClass = 'bg-green-100 text-green-800';
                    }
                    
                    orderItem.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">Commande #${order.id.toString().slice(-4)}</h4>
                                <p class="text-sm text-gray-500">${order.customerName}</p>
                            </div>
                            <div>
                                <span class="text-xs px-2 py-1 rounded-full ${statusClass}">${getStatusText(order.status)}</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-md font-semibold">${order.total.toFixed(2)} €</span>
                            <div class="space-x-2">
                                ${order.status === 'pending' ? `
                                <button class="action-btn text-xs px-2 py-1 bg-blue-500 text-white rounded" data-id="${order.id}" data-action="prepare">
                                    Préparer
                                </button>
                                ` : ''}
                                ${order.status === 'preparing' ? `
                                <button class="action-btn text-xs px-2 py-1 bg-green-500 text-white rounded" data-id="${order.id}" data-action="complete">
                                    Terminer
                                </button>
                                ` : ''}
                                <button class="action-btn text-xs px-2 py-1 bg-red-500 text-white rounded" data-id="${order.id}" data-action="delete">
                                    Supprimer
                                </button>
                            </div>
                        </div>
                    `;
                    
                    recentOrdersList.appendChild(orderItem);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('.action-btn').forEach(button => {
                    button.addEventListener('click', () => handleOrderAction(button.dataset.action, parseInt(button.dataset.id)));
                });
            } else {
                recentOrdersList.innerHTML = `
                    <div class="text-center py-6 text-gray-500">
                        <i class="fas fa-clipboard-list text-3xl mb-2"></i>
                        <p>Aucune commande récente</p>
                    </div>
                `;
            }
        }
        
        function renderOrders(search = '', filter = 'all') {
            let filteredOrders = [...orders];
            
            // Apply search filter
            if (search) {
                const searchLower = search.toLowerCase();
                filteredOrders = filteredOrders.filter(order => 
                    order.customerName.toLowerCase().includes(searchLower) || 
                    order.id.toString().includes(searchLower)
                );
            }
            
            // Apply status filter
            if (filter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === filter);
            }
            
            // Sort by date (newest first)
            filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredOrders.length > 0) {
                ordersList.innerHTML = '';
                
                filteredOrders.forEach(order => {
                    const orderItem = document.createElement('div');
                    orderItem.className = 'bg-white p-4 rounded-lg shadow-sm mb-4 order-card';
                    
                    let statusClass = '';
                    if (order.status === 'pending') {
                        statusClass = 'bg-yellow-100 text-yellow-800';
                    } else if (order.status === 'preparing') {
                        statusClass = 'bg-blue-100 text-blue-800';
                    } else if (order.status === 'completed') {
                        statusClass = 'bg-green-100 text-green-800';
                    }
                    
                    let itemsList = '';
                    order.items.forEach(item => {
                        itemsList += `
                            <div class="flex justify-between py-1 px-2">
                                <span class="text-sm">${item.drink.name} × ${item.quantity}</span>
                                <span class="text-sm">${(item.drink.price * item.quantity).toFixed(2)} €</span>
                            </div>
                        `;
                    });
                    
                    orderItem.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">Commande #${order.id.toString().slice(-4)}</h4>
                                <p class="text-sm text-gray-500">${order.customerName}</p>
                                <p class="text-xs text-gray-400 mt-1">${new Date(order.date).toLocaleString()}</p>
                            </div>
                            <div>
                                <span class="text-xs px-2 py-1 rounded-full ${statusClass}">${getStatusText(order.status)}</span>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded p-2 mb-4">
                            ${itemsList}
                        </div>
                        
                        <div class="flex justify-between items-center border-t pt-3">
                            <span class="text-lg font-semibold">Total: ${order.total.toFixed(2)} €</span>
                            <div class="space-x-2">
                                ${order.status === 'pending' ? `
                                <button class="action-btn px-3 py-1 bg-blue-500 text-white rounded text-sm" data-id="${order.id}" data-action="prepare">
                                    <i class="fas fa-hourglass-start mr-1"></i> Préparer
                                </button>
                                ` : ''}
                                ${order.status === 'preparing' ? `
                                <button class="action-btn px-3 py-1 bg-green-500 text-white rounded text-sm" data-id="${order.id}" data-action="complete">
                                    <i class="fas fa-check mr-1"></i> Terminer
                                </button>
                                ` : ''}
                                <button class="action-btn px-3 py-1 bg-red-500 text-white rounded text-sm" data-id="${order.id}" data-action="delete">
                                    <i class="fas fa-trash mr-1"></i> Supprimer
                                </button>
                            </div>
                        </div>
                    `;
                    
                    ordersList.appendChild(orderItem);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('.action-btn').forEach(button => {
                    button.addEventListener('click', () => handleOrderAction(button.dataset.action, parseInt(button.dataset.id)));
                });
            } else {
                ordersList.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>Aucune commande trouvée</p>
                    </div>
                `;
            }
        }
        
        function handleOrderAction(action, orderId) {
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;
            
            switch(action) {
                case 'prepare':
                    orders[orderIndex].status = 'preparing';
                    break;
                case 'complete':
                    orders[orderIndex].status = 'completed';
                    break;
                case 'delete':
                    if (confirm('Êtes-vous sûr de vouloir supprimer cette commande ?')) {
                        orders.splice(orderIndex, 1);
                    } else {
                        return;
                    }
                    break;
            }
            
            saveData();
            
            // Refresh views
            if (document.querySelector('.admin-tab.active').dataset.tab === 'dashboard') {
                refreshDashboard();
            } else {
                renderOrders(orderSearch.value, orderFilter.value);
            }
            
            showNotification(`Commande ${action === 'delete' ? 'supprimée' : 'mise à jour'}`);
        }
        
        function renderProducts(search = '', category = 'all') {
            let filteredProducts = [...drinks];
            
            // Apply search filter
            if (search) {
                const searchLower = search.toLowerCase();
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchLower) || 
                    product.description.toLowerCase().includes(searchLower)
                );
            }
            
            // Apply category filter
            if (category !== 'all') {
                filteredProducts = filteredProducts.filter(product => product.category === category);
            }
            
            if (filteredProducts.length > 0) {
                productsList.innerHTML = '';
                
                filteredProducts.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'bg-white rounded-lg shadow-md overflow-hidden';
                    
                    let categoryBadge = '';
                    if (product.category === 'cold') {
                        categoryBadge = '<span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded ml-2">Froid</span>';
                    } else if (product.category === 'hot') {
                        categoryBadge = '<span class="inline-block bg-red-100 text-red-800 text-xs px-2 py-1 rounded ml-2">Chaud</span>';
                    } else if (product.category === 'alcohol') {
                        categoryBadge = '<span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded ml-2">Alcool</span>';
                    }
                    
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-semibold">${product.name}</h3>
                                <div>${categoryBadge}</div>
                            </div>
                            <p class="text-gray-600 text-sm mb-3">${product.description}</p>
                            <div class="flex justify-between items-center">
                                <span class="font-bold text-blue-600">${product.price.toFixed(2)} €</span>
                                <div class="flex space-x-2">
                                    <button class="edit-product-btn px-3 py-1 bg-blue-500 text-white rounded text-sm" data-id="${product.id}">
                                        <i class="fas fa-edit mr-1"></i> Modifier
                                    </button>
                                    <button class="delete-product-btn px-3 py-1 bg-red-500 text-white rounded text-sm" data-id="${product.id}">
                                        <i class="fas fa-trash mr-1"></i> Supprimer
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    productsList.appendChild(productCard);
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-product-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const productId = parseInt(button.dataset.id);
                        editProduct(productId);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-product-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const productId = parseInt(button.dataset.id);
                        deleteProduct(productId);
                    });
                });
            } else {
                productsList.innerHTML = `
                    <div class="text-center py-12 text-gray-500 col-span-full">
                        <i class="fas fa-cocktail text-4xl mb-4"></i>
                        <p>Aucun produit trouvé</p>
                    </div>
                `;
            }
        }
        
        function openProductModal() {
            productModalTitle.textContent = 'Ajouter un produit';
            productName.value = '';
            productDescription.value = '';
            productPrice.value = '';
            productCategory.value = 'cold';
            productImageUrl.value = '';
            editingProductId = null;
            
            productModal.classList.remove('hidden');
        }
        
        function editProduct(productId) {
            const product = drinks.find(d => d.id === productId);
            if (!product) return;
            
            productModalTitle.textContent = 'Modifier le produit';
            productName.value = product.name;
            productDescription.value = product.description;
            productPrice.value = product.price;
            productCategory.value = product.category;
            productImageUrl.value = product.image;
            editingProductId = productId;
            
            productModal.classList.remove('hidden');
        }
        
        function closeProductModal() {
            productModal.classList.add('hidden');
        }
        
        function saveProduct() {
            const name = productName.value.trim();
            const description = productDescription.value.trim();
            const price = parseFloat(productPrice.value);
            const category = productCategory.value;
            let imageUrl = productImageUrl.value.trim();
            
            if (!name || isNaN(price) || price <= 0) {
                showNotification('Veuillez remplir tous les champs correctement', 'error');
                return;
            }
            
            if (!imageUrl) {
                imageUrl = `https://placehold.co/300x200?text=${encodeURIComponent(name)}`;
            }
            
            if (editingProductId) {
                // Update existing product
                const index = drinks.findIndex(d => d.id === editingProductId);
                if (index !== -1) {
                    drinks[index] = {
                        id: editingProductId,
                        name,
                        description,
                        price,
                        category,
                        image: imageUrl
                    };
                }
                
                showNotification('Produit mis à jour');
            } else {
                // Add new product
                const newId = drinks.length > 0 ? Math.max(...drinks.map(d => d.id)) + 1 : 1;
                drinks.push({
                    id: newId,
                    name,
                    description,
                    price,
                    category,
                    image: imageUrl
                });
                
                showNotification('Produit ajouté');
            }
            
            saveData();
            renderProducts(productSearch.value, productCategoryFilter.value);
            closeProductModal();
            
            // Update dashboard if needed
            if (document.querySelector('.admin-tab.active').dataset.tab === 'dashboard') {
                refreshDashboard();
            }
        }
        
        function deleteProduct(productId) {
            const product = drinks.find(d => d.id === productId);
            if (!product) return;
            
            if (confirm(`Êtes-vous sûr de vouloir supprimer "${product.name}" ?`)) {
                drinks = drinks.filter(d => d.id !== productId);
                saveData();
                renderProducts(productSearch.value, productCategoryFilter.value);
                showNotification('Produit supprimé');
                
                // Update dashboard if needed
                if (document.querySelector('.admin-tab.active').dataset.tab === 'dashboard') {
                    refreshDashboard();
                }
            }
        }
        
        function renderUsers() {
            if (users.length > 0) {
                usersList.innerHTML = '';
                
                users.forEach(user => {
                    const userRow = document.createElement('tr');
                    userRow.className = 'border-b hover:bg-gray-50';
                    
                    userRow.innerHTML = `
                        <td class="p-3">${user.username}</td>
                        <td class="p-3">${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Jamais'}</td>
                        <td class="p-3">
                            ${user.id !== currentAdmin.id ? `
                            <button class="delete-user-btn px-3 py-1 bg-red-500 text-white rounded text-sm" data-id="${user.id}">
                                <i class="fas fa-trash mr-1"></i> Supprimer
                            </button>` : ''}
                        </td>
                    `;
                    
                    usersList.appendChild(userRow);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-user-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const userId = parseInt(button.dataset.id);
                        deleteUser(userId);
                    });
                });
            } else {
                usersList.innerHTML = `
                    <tr>
                        <td colspan="3" class="p-4 text-center text-gray-500">
                            <i class="fas fa-users text-2xl mb-2"></i>
                            <p>Aucun utilisateur trouvé</p>
                        </td>
                    </tr>
                `;
            }
        }
        
        function openUserModal() {
            userModalTitle.textContent = 'Ajouter un administrateur';
            newUsername.value = '';
            newPassword.value = '';
            confirmPassword.value = '';
            editingUserId = null;
            userError.classList.add('hidden');
            
            userModal.classList.remove('hidden');
        }
        
        function closeUserModal() {
            userModal.classList.add('hidden');
        }
        
        function saveUser() {
            const username = newUsername.value.trim();
            const password = newPassword.value;
            const confirmPass = confirmPassword.value;
            
            if (!username || !password || !confirmPass) {
                userError.textContent = 'Veuillez remplir tous les champs';
                userError.classList.remove('hidden');
                return;
            }
            
            if (password !== confirmPass) {
                userError.textContent = 'Les mots de passe ne correspondent pas';
                userError.classList.remove('hidden');
                return;
            }
            
            // Check if username already exists (unless we're editing)
            if (!editingUserId && users.some(u => u.username === username)) {
                userError.textContent = 'Ce nom d\'utilisateur est déjà pris';
                userError.classList.remove('hidden');
                return;
            }
            
            if (editingUserId) {
                // Update existing user
                const index = users.findIndex(u => u.id === editingUserId);
                if (index !== -1) {
                    users[index] = {
                        ...users[index],
                        username,
                        password // In a real app, we would hash the password
                    };
                }
                
                showNotification('Utilisateur mis à jour');
            } else {
                // Add new user
                const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
                users.push({
                    id: newId,
                    username,
                    password, // In a real app, we would hash the password
                    lastLogin: null
                });
                
                showNotification('Utilisateur ajouté');
            }
            
            saveData();
            renderUsers();
            closeUserModal();
        }
        
        function deleteUser(userId) {
            if (userId === currentAdmin.id) {
                showNotification('Vous ne pouvez pas supprimer votre propre compte', 'error');
                return;
            }
            
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            if (confirm(`Êtes-vous sûr de vouloir supprimer l'utilisateur "${user.username}" ?`)) {
                users = users.filter(u => u.id !== userId);
                saveData();
                renderUsers();
                showNotification('Utilisateur supprimé');
            }
        }
        
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'En attente';
                case 'preparing': return 'En préparation';
                case 'completed': return 'Terminée';
                default: return status;
            }
        }
        
        function showNotification(message, type = 'success') {
            notificationMessage.textContent = message;
            
            // Set color based on type
            if (type === 'success') {
                notification.classList.remove('bg-red-500', 'bg-yellow-500');
                notification.classList.add('bg-green-500');
            } else if (type === 'error') {
                notification.classList.remove('bg-green-500', 'bg-yellow-500');
                notification.classList.add('bg-red-500');
            } else {
                notification.classList.remove('bg-green-500', 'bg-red-500');
                notification.classList.add('bg-yellow-500');
            }
            
            notification.classList.remove('hidden');
            notification.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 500);
            }, 3000);
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
